{"version":3,"kind":"Notebook","sha256":"ecf21c094d169c30288b5ba82c60431d3e54e6195b08ef72cafe4131f5ff36d6","slug":"notebooks.gpr-lidar-hackweektutorial","location":"/notebooks/GPR_Lidar_HackweekTutorial.ipynb","dependencies":[],"frontmatter":{"title":"GPR and Lidar","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"authors":[{"nameParsed":{"literal":"The NASA Snow Observations Community","given":"The NASA Snow Observations","family":"Community"},"name":"The NASA Snow Observations Community","id":"contributors-myst-generated-uid-0"}],"open_access":true,"license":{"content":{"id":"CC-BY-4.0","url":"https://creativecommons.org/licenses/by/4.0/","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true},"code":{"id":"Apache-2.0","url":"https://opensource.org/licenses/Apache-2.0","name":"Apache License 2.0","free":true,"osi":true}},"github":"https://github.com/SnowEx/snow-observations-cookbook","copyright":"2025","affiliations":[{"id":"UAlbany","name":"University at Albany (SUNY)","department":"Atmospheric and Environmental Sciences","url":"https://www.albany.edu/daes"},{"id":"CISL","name":"NSF National Center for Atmospheric Research","department":"Computational and Information Systems Lab","url":"https://www.cisl.ucar.edu"},{"id":"Unidata","name":"NSF Unidata","url":"https://www.unidata.ucar.edu"},{"id":"Argonne","name":"Argonne National Laboratory","department":"Environmental Science Division","url":"https://www.anl.gov/evs"},{"id":"CarbonPlan","name":"CarbonPlan","url":"https://carbonplan.org"},{"id":"NVIDIA","name":"NVIDIA Corporation","url":"https://www.nvidia.com/"}],"numbering":{"title":{"offset":1}},"source_url":"https://github.com/SnowEx/snow-observations-cookbook/blob/main/notebooks/GPR_Lidar_HackweekTutorial.ipynb","edit_url":"https://github.com/SnowEx/snow-observations-cookbook/edit/main/notebooks/GPR_Lidar_HackweekTutorial.ipynb","thumbnail":"/snow-observations-cookbook/_preview/7/build/HackweekGraphicalAbs-7b78c425bb0c93cee59d2a75078fa6ad.png","exports":[{"format":"ipynb","filename":"GPR_Lidar_HackweekTutorial.ipynb","url":"/snow-observations-cookbook/_preview/7/build/GPR_Lidar_HackweekTu-775297649dfcc9b3001de9cd440b6af0.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook is designed to obtain snow depth, density, and SWE from ground-penetrating radar data. We will use GPR data gathered during the SnowEx Alaska campaigns, with validation from the airborne lidar obtained during the same campaign.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KxTT1uiehg"}],"key":"scgjhj2WvD"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The text and code in this notebook is adapted from Randall Bonnell‚Äôs tutorial on lidar and GPR during the 2024 SnowEx Hackweek, found here: ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"v2IwWPTmVT"},{"type":"link","url":"https://snowex-2024.hackweek.io/tutorials/gpr_lidar/GPR_Lidar_HackweekTutorial.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"https://‚Äãsnowex‚Äã-2024‚Äã.hackweek‚Äã.io‚Äã/tutorials‚Äã/gpr‚Äã_lidar‚Äã/GPR‚Äã_Lidar‚Äã_HackweekTutorial‚Äã.html","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Y2czjDLRKM"}],"urlSource":"https://snowex-2024.hackweek.io/tutorials/gpr_lidar/GPR_Lidar_HackweekTutorial.html","key":"QBwIyURCSe"}],"key":"UDQ3jQWqJw"}],"key":"BY5FjoJDZF"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"!pip install -U snowexsql","key":"k0ox0jozai"},{"type":"outputs","id":"v_zoeFpc4FGBycv7IC-pp","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"Requirement already satisfied: snowexsql in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (1.1.0rc2.dev10)\r\n"},"key":"g7JzWUzced"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"Requirement already satisfied: boto3<2.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (1.42.47)\r\nRequirement already satisfied: geoalchemy2<1.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (0.18.1)\r\nRequirement already satisfied: geopandas<2.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (1.1.2)\r\nRequirement already satisfied: psycopg2-binary<3.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (2.9.11)\r\nRequirement already satisfied: rasterio<2.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (1.5.0)\r\nRequirement already satisfied: requests<3.0,>=2.31.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (2.32.5)\r\nRequirement already satisfied: sqlalchemy<3.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (2.0.46)\r\nRequirement already satisfied: urllib3<3.0,>=2.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (2.6.3)\r\nRequirement already satisfied: utm<0.9 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from snowexsql) (0.8.1)\r\nRequirement already satisfied: botocore<1.43.0,>=1.42.47 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from boto3<2.0->snowexsql) (1.42.47)\r\nRequirement already satisfied: jmespath<2.0.0,>=0.7.1 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from boto3<2.0->snowexsql) (1.1.0)\r\nRequirement already satisfied: s3transfer<0.17.0,>=0.16.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from boto3<2.0->snowexsql) (0.16.0)\r\nRequirement already satisfied: python-dateutil<3.0.0,>=2.1 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from botocore<1.43.0,>=1.42.47->boto3<2.0->snowexsql) (2.9.0.post0)\r\n"},"key":"IVAOvCAGzx"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"Requirement already satisfied: packaging in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from geoalchemy2<1.0->snowexsql) (26.0)\r\nRequirement already satisfied: numpy>=1.24 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from geopandas<2.0->snowexsql) (2.3.5)\r\nRequirement already satisfied: pandas>=2.0.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from geopandas<2.0->snowexsql) (2.3.3)\r\nRequirement already satisfied: shapely>=2.0.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from geopandas<2.0->snowexsql) (2.1.2)\r\nRequirement already satisfied: six>=1.5 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from python-dateutil<3.0.0,>=2.1->botocore<1.43.0,>=1.42.47->boto3<2.0->snowexsql) (1.17.0)\r\nRequirement already satisfied: affine in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from rasterio<2.0->snowexsql) (2.4.0)\r\nRequirement already satisfied: attrs in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from rasterio<2.0->snowexsql) (25.4.0)\r\nRequirement already satisfied: certifi in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from rasterio<2.0->snowexsql) (2026.1.4)\r\nRequirement already satisfied: click!=8.2.*,>=4.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from rasterio<2.0->snowexsql) (8.3.1)\r\nRequirement already satisfied: cligj>=0.5 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from rasterio<2.0->snowexsql) (0.7.2)\r\nRequirement already satisfied: pyparsing in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from rasterio<2.0->snowexsql) (3.3.2)\r\nRequirement already satisfied: charset_normalizer<4,>=2 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from requests<3.0,>=2.31.0->snowexsql) (3.4.4)\r\nRequirement already satisfied: idna<4,>=2.5 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from requests<3.0,>=2.31.0->snowexsql) (3.11)\r\nRequirement already satisfied: greenlet>=1 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from sqlalchemy<3.0->snowexsql) (3.3.1)\r\nRequirement already satisfied: typing-extensions>=4.6.0 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from sqlalchemy<3.0->snowexsql) (4.15.0)\r\nRequirement already satisfied: pytz>=2020.1 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from pandas>=2.0.0->geopandas<2.0->snowexsql) (2025.2)\r\nRequirement already satisfied: tzdata>=2022.7 in /home/runner/micromamba/envs/snow-observations-cookbook/lib/python3.14/site-packages (from pandas>=2.0.0->geopandas<2.0->snowexsql) (2025.3)\r\n"},"key":"SnqJNAkJNV"}],"key":"smEFQGYetB"}],"key":"ld2VfMqY4t"},{"type":"block","kind":"notebook-content","children":[{"type":"image","url":"/snow-observations-cookbook/_preview/7/build/HackweekGraphicalAbs-7b78c425bb0c93cee59d2a75078fa6ad.png","alt":"Title Card","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZXzCS7EeHm","urlSource":"./images/gpr_lidar/HackweekGraphicalAbstract_GPR_Lidar_v2.png"}],"key":"qII0fMh7I0"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"1. GPR Methods for the Retrieval of Snow Depth and SWE","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KK0NkEX88g"}],"identifier":"id-1-gpr-methods-for-the-retrieval-of-snow-depth-and-swe","label":"1. GPR Methods for the Retrieval of Snow Depth and SWE","html_id":"id-1-gpr-methods-for-the-retrieval-of-snow-depth-and-swe","implicit":true,"key":"yJ3odsJuQu"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"What is GPR?","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Qhhajn2sVd"}],"identifier":"what-is-gpr","label":"What is GPR?","html_id":"what-is-gpr","implicit":true,"key":"ku34rqf7EO"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"GPR transmits a radar signal into the snowpack, which then reflects off objects/interfaces with contrasting dielectric permittivity. The GPR records the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Dvyd48yWDD"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"amplitude","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Lw1iY0DCHH"}],"key":"SdJjlg3kc0"},{"type":"text","value":" and ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zAlmNmyysy"},{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"two-way travel time (twt)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"JB7NQ9H4A9"}],"key":"hbkhYYN7G7"},{"type":"text","value":" of the reflections.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"sba4G1rcp9"}],"key":"tXLJFowXWy"}],"key":"GW7rsmx9sA"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Dielectric permittivity","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HvHYc14A1K"}],"key":"USuKVhomJ0"},{"type":"text","value":" refers to the dielectric properties of the snowpack that define how EM energy trasmits through the medium.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"UOGIOWf410"}],"key":"rmlqKbNCFk"}],"key":"Xizq1ILymM"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Usually, we are interested in the snow-ground interface, and we measure the snowpack thickness (depth) in two-way travel time (in nanoseconds).","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"RZRwDgoUpq"}],"key":"Il30GKG0oi"}],"key":"N6ixuztqBN"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Most analysis-ready GPR products have twt, snow depth, and SWE variables. Some have also been updated to include derived snow density","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"azyeucs7fe"}],"key":"rVmUvSHqJA"}],"key":"D9nJSMC9HQ"}],"key":"ia2qjvtwYT"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"For this notebook, we will start from the two-way travel time data to derive our snow properties of interest, and compare it to airborne lidar data. The ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"v5yDfritcU"},{"type":"inlineCode","value":"snowexsql","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"LxedSiou0f"},{"type":"text","value":" package will be needed.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GrPVrA9zUY"}],"key":"RsnSsYAWnn"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Note that the results derived here are for the user‚Äôs reference - most of the GPR products posted on NSIDC already have snow depth and SWE available as variables.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"VeIwN7cJpK"}],"key":"V7WNVrC75g"}],"key":"u7a6oVA1zh"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"2. SnowEx23 GPR/Lidar Derived Permittivities/Densities in the Boreal Forest, Alaska","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T3407cGs05"}],"identifier":"id-2-snowex23-gpr-lidar-derived-permittivities-densities-in-the-boreal-forest-alaska","label":"2. SnowEx23 GPR/Lidar Derived Permittivities/Densities in the Boreal Forest, Alaska","html_id":"id-2-snowex23-gpr-lidar-derived-permittivities-densities-in-the-boreal-forest-alaska","implicit":true,"key":"EyCWRGcMHm"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Deriving Snow Density at Farmer‚Äôs Loop/Creamer‚Äôs Field","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TqmREi2Ez7"}],"identifier":"deriving-snow-density-at-farmers-loop-creamers-field","label":"Deriving Snow Density at Farmer‚Äôs Loop/Creamer‚Äôs Field","html_id":"deriving-snow-density-at-farmers-loop-creamers-field","implicit":true,"key":"q9dqPZtq7v"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"For this first step, we will use:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"mGmwIbDIMD"}],"key":"UtoyfzCWvH"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Airborne lidar data collected on 11 March, 2023.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"hJuLoyvLgN"}],"key":"tTHqvea2Je"}],"key":"aNGcHMkuRK"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"GPR data collected on 7, 11, 13, and 16 March, 2023.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"PWcZKk2GBW"}],"key":"n9pA7kCdw8"}],"key":"niEPAFJcwl"}],"key":"BfXjMg2dQm"}],"key":"AJbHfLZ2kD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"#1.1 Load relevant packages\nimport os\nimport numpy as np \nfrom datetime import date\nfrom scipy.spatial import cKDTree\n\n#packages for figures\nimport matplotlib.pyplot as plt\nfrom rasterio.plot import show\n\n#geospatial packages\nimport geopandas as gpd #for vector data\nimport xarray as xr\nimport pandas as pd\nfrom shapely.geometry import box, Point\n\nimport rasterio as rio\n\nfrom snowexsql.lambda_client import SnowExLambdaClient\n","key":"aQQF8tqJy7"},{"type":"outputs","id":"6rm8LQEAHQT1OnEl7tzeU","children":[],"key":"UvTcto7W9Z"}],"key":"K3XhU3ejqD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Initialize client\nclient = SnowExLambdaClient()\n\n# Get all measurement classes dynamically\nclasses = client.get_measurement_classes()\nLayerMeasurements = classes['LayerMeasurements']\nPointMeasurements = classes['PointMeasurements']\nRasterMeasurements = classes['RasterMeasurements']\n\nprint(\"üîç Testing Lambda connection...\")\nconnection_test = client.test_connection()\nprint(f\"‚úÖ Connected: {connection_test.get('connected', False)}\")\nif connection_test.get('connected'):\n    print(f\"üìä Database: {connection_test.get('version', 'Unknown version')}\")\nelse:\n    print(\"‚ùå Connection failed\")\n","key":"IE7miZJtLt"},{"type":"outputs","id":"eCFYupSdIsWv9gBxVcBg8","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"üîç Testing Lambda connection...\n"},"key":"f3RU1vBiia"},{"type":"output","children":[],"jupyter_data":{"output_type":"stream","name":"stdout","text":"‚úÖ Connected: True\nüìä Database: PostgreSQL 16.10 on x86_64-conda-linux-gnu, compiled by x86_64-conda-linux-gnu-cc (conda-forge gcc 14.3.0-4) 14.3.0, 64-bit\n"},"key":"awi9CUM3Ev"}],"key":"ycGMCZoJ0v"}],"key":"qAXOWVz81r"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Part 1: Load the GPR data from the SnowEx data base","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yHodzJiySX"}],"identifier":"part-1-load-the-gpr-data-from-the-snowex-data-base","label":"Part 1: Load the GPR data from the SnowEx data base","html_id":"part-1-load-the-gpr-data-from-the-snowex-data-base","implicit":true,"key":"isCvhxS7Nm"}],"key":"gXs8ew488A"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Query all point measurements within 1000m of Creamer's Field center\n# Creamer's Field coordinates: 64.864167¬∞N, 147.737778¬∞W (EPSG:4326)\n# Converting to a Point geometry for the query\n\n# Center point of Creamer's Field\ncreamers_field_center = Point(-147.737778, 64.864167)\n\n# Query with 1000m buffer around the center point\ndf = PointMeasurements.from_area(\n    pt=creamers_field_center,\n    crs=4326,  # WGS84 coordinate system\n    buffer=1000,  # 1000 meters\n    type='two_way_travel',\n    observer='Randall Bonnell',\n    limit=20000,  # Adjust limit as needed\n    verbose=False\n)","key":"XMk8pkz0uL"},{"type":"outputs","id":"f7TR_28hoXO48y-s7Sigw","children":[],"key":"dTRsxhSFBi"}],"key":"bH9mWKFId7"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df.plot()","key":"NOQnD1JXlF"},{"type":"outputs","id":"JdeH68AkX04zeTUfKx8cV","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},"key":"JX5091AMpf"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"d566add52251374443f71db8cebe1e21","path":"/snow-observations-cookbook/_preview/7/build/d566add52251374443f71db8cebe1e21.png"}}},"key":"TnjHorwsLF"}],"key":"NoMx4Kyj4n"}],"key":"mVm9OD3Dhe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Let's look at the distribution of gpr two-way travel times and estimated snow depths\n#Estimate snow depths from twt by assuming a velocity of 0.25 m/ns --> Is this an appropriate velocity estimate?\ndf['Depth_estimated'] = (df['value']/2)*0.25\n\nax1 = df.plot.hist(column=[\"value\"], edgecolor='black', title='two-way travel time (ns)')\nax2 = df.plot.hist(column=[\"Depth_estimated\"], edgecolor='black', title='Snow depth (m)')","key":"ptmBvGJBwE"},{"type":"outputs","id":"9FoDe8qd7DxtJkO7PbGrf","children":[{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"32f72dcee2f288e3072f5955924e7f16","path":"/snow-observations-cookbook/_preview/7/build/32f72dcee2f288e3072f5955924e7f16.png"}}},"key":"WSiZnslTRl"},{"type":"output","children":[],"jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"},"image/png":{"content_type":"image/png","hash":"89b4ee7ae86e4a9ff1317f6f7060f9b9","path":"/snow-observations-cookbook/_preview/7/build/89b4ee7ae86e4a9ff1317f6f7060f9b9.png"}}},"key":"O5ouEJ0BVd"}],"key":"lkXCxpckod"}],"key":"jSLFUEvrpz"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load Lidar-Derived Canopy Height and Snow Depth","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LfAU9TOOlP"}],"identifier":"load-lidar-derived-canopy-height-and-snow-depth","label":"Load Lidar-Derived Canopy Height and Snow Depth","html_id":"load-lidar-derived-canopy-height-and-snow-depth","implicit":true,"key":"ZzvvHqClkk"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To compare against the GPR data, we will load airborne lidar data products, specifically canopy height and snow depths. To facilitate our analysis, we will create a bounding box for the lidar results using our GPR data.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wZRzrOx4QO"}],"key":"WZOaIOF5Ja"}],"key":"ylU2TDxdEo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Extract x/y limit from GPR data\nbounds = df.total_bounds\n\n# Create a bounding box\ngpr_limits = box(*bounds)","key":"zYx8aYVNT0"},{"type":"outputs","id":"Q9hERmmWujBOBVnwNJHRI","children":[],"key":"gMQbhWJDQB"}],"key":"BvVfgVzniI"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Aside from this bounding box, accessing the lidar data is very similar to the GPR data. However, because the lidar data is much larger, loading it through the database may take a few minutes.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OKs1kliNXJ"}],"key":"f3hEsAyfpI"}],"key":"gggxcB7rcH"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Commented until we fix reading of raster data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qrqbaQNvPL"}],"identifier":"commented-until-we-fix-reading-of-raster-data","label":"Commented until we fix reading of raster data","html_id":"commented-until-we-fix-reading-of-raster-data","implicit":true,"key":"wBLPmRri4w"}],"key":"yTl8FzQRPN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Load lidar canopy heights\n#flcf_ch = RasterMeasurements.from_area(shp=gpr_limits,\n#                                      crs=26906,\n#                                      buffer=None,\n#                                      type='canopy_height',\n#                                      site_name='farmers-creamers',\n#                                      observers='chris larsen'\n#                                      )\n#print(flcf_ch)","key":"d68Q9tJQUO"},{"type":"outputs","id":"6uaw2uOvIo_t4bgsVRrQz","children":[],"key":"OSFrc6mdzp"}],"key":"vmwA6bm52n"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# Load lidar snow depths\n#flcf_sd = RasterMeasurements.from_area(shp=gpr_limits,\n#                                       crs=26906,\n#                                       buffer=None,\n#                                       type='depth',\n#                                       site_name='farmers-creamers',\n#                                       observers='chris larsen'\n#                                      )\n#print(flcf_sd)","key":"IqBLO5Zk9e"},{"type":"outputs","id":"6HqAQATp2DuCDiD-KNxkG","children":[],"key":"PEl1YlKA2s"}],"key":"R8hiCSX57i"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Match GPR data with lidar data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FUJQFgmvGb"}],"identifier":"match-gpr-data-with-lidar-data","label":"Match GPR data with lidar data","html_id":"match-gpr-data-with-lidar-data","implicit":true,"key":"nX6I7Q5vId"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"To match the GPR and lidar data, we can either rasterize the GPR data or vectorize the lidar data. For simplicity, we will vectorize the lidar data and perform a nearest neighbor search.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"KSTBhHdqnK"}],"key":"iWw9E8hG1G"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"The GPR data is ~0.1 m resolution, whereas the lidar data is ~0.5 m resolution. So, we can expect ~5 GPR data points per lidar pixel.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"YX2ZVFMjxR"}],"key":"ONw2zvk00a"}],"key":"iLdW9Ar7Ga"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Find height and width of array\n# height, width = flcf_sd.read(1).shape\n\n# # Create arrays of the height, width of the lidar raster\n# cols, rows = np.meshgrid(np.arange(width), np.arange(height))\n\n# # Get the easting/northing from the lidar raster\n# x_lidar, y_lidar = rio.transform.xy(flcf_sd.transform, rows, cols)\n\n# # Vectorize the raster data\n# x_lidar_vec = np.array(x_lidar).flatten()\n# y_lidar_vec = np.array(y_lidar).flatten()\n# flcf_sd_vec = flcf_sd.read().flatten()\n\n# # Pull vectors from GPR GeoDataFrame\n# gpr_arr = np.stack([gpr_df.geometry.x, gpr_df.geometry.y, gpr_df['value']], axis=1)\n# gpr_x = gpr_arr[:,0]\n# gpr_y = gpr_arr[:,1]\n# gpr_twt = gpr_arr[:,2].reshape(len(gpr_arr[:,2]), 1)\n","key":"PMdNJXN1bB"},{"type":"outputs","id":"l27FOw0QFGhOQl3tHEmp_","children":[],"key":"a8M4T0OmI8"}],"key":"KpPC9Ljl7u"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For the nearest-neighbor approach, we will be using a K-D tree to efficiently find adjacent points.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"z3MVRgvbgS"}],"key":"sgu3wuOtuU"}],"key":"FshUtT3ot8"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Create coordinate sets for nearest neighbor search\n# set1 = np.column_stack((x_lidar_vec, y_lidar_vec))\n# set2 = np.column_stack((gpr_x, gpr_y))\n\n# # Build KDTree from GPR coordinates\n# tree = cKDTree(set2)\n\n# # Define the search radius (meters)\n# radius = 0.25\n\n# # Create function to find median travel times\n# def median_travel_time(point, gpr_kdtree, gpr_coordinates, gpr_twt, radius):\n#     indices = tree.query_ball_point(point, radius)\n#     if indices:\n#         # Retrieve travel times for the nearest neighbors\n#         neighbor_twt = gpr_twt[indices]\n#         median_twt = np.median(neighbor_twt)\n\n#         return median_twt\n\n#     else:\n#         return np.nan\n\n# # Find twt medians for each lidar point\n# twt_median = np.array([median_travel_time(point,tree,set2,gpr_twt,radius) for point in set1])\n# print(twt_median)\n","key":"qYMVNqr8XR"},{"type":"outputs","id":"05g7BuolWxixg3h0dD1S9","children":[],"key":"q1aWUg5hxb"}],"key":"KlaXbJ0kg3"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The GPR data is not as spatially continuous as the lidar data, so ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YCtwiQGh9C"},{"type":"inlineCode","value":"twt_median","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oO2VfaJBeZ"},{"type":"text","value":" has a lot of NaN values. To reduce memory usage, let‚Äôs remove those.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EQVw9ttBin"}],"key":"c2wOmsMhsM"}],"key":"F8BMtLpw8l"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Create mask for GPR NaN values\n# mask = np.isnan(twt_median)\n\n# # Mask GPR/lidar vectors\n# flcf_sd_vec_clean = flcf_sd_vec[~mask]\n# set1_clean = set1[~mask]\n# twt_median_clean = twt_median[~mask]\n\n# print(twt_median_clean.shape)","key":"pfIv6m1Ohw"},{"type":"outputs","id":"_XeWjqWHXGj-PcNXioYSC","children":[],"key":"A2NsrjnZtc"}],"key":"dpvWDVppcE"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now that the data is matched, and we have removed NaN values, we can now calculate relative permittivity and snow density.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YRSS2mYKXR"}],"key":"HXAP23CddZ"}],"key":"MyTEmNoY3L"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Calculate relative permittivity\n# c = 0.2998 # Speed of light in a vaccuum\n# e_s = ((c*twt_median_clean) / (2*flcf_sd_vec_clean))**2\n\n# # Calculate snow density\n# rho_s = ((np.sqrt(e_s)-1) / 0.845)*1000","key":"xGCL4ZO404"},{"type":"outputs","id":"aAKEKuAHTVci8MM6UX0JZ","children":[],"key":"BixRNG9uDb"}],"key":"oABYUEPODb"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Examine the derived densities","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eaFnvuQLtB"}],"identifier":"examine-the-derived-densities","label":"Examine the derived densities","html_id":"examine-the-derived-densities","implicit":true,"key":"zmkC9lCEuB"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Now that we‚Äôve gone through all of this trouble, let‚Äôs take a look at the derived snow densities.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ZuH1fqEwVC"}],"key":"RMr6bXML5Y"}],"key":"nXLBjknnth"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Plot snow density\n# plt.figure()\n# plt.scatter(set1_clean[:,0], set1_clean[:,1], s=10,\n#             c=rho_s, cmap='viridis', clim=(0,500),\n#             edgecolor=None\n#            )\n# plt.colorbar()\n# plt.title('Snow density [kg m-3]')\n# plt.show()","key":"LxA5EHOMOl"},{"type":"outputs","id":"SvtCcH9QGd41n8xLQXMe7","children":[],"key":"JHWsDsTdgJ"}],"key":"lyEBx5DFAl"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can also check the histogram distribution of snow density.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NRH9zZ0hgh"}],"key":"oEPH4JmH2b"}],"key":"PAD1tRqzkN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Define bin edges\n# bin_edges = np.arange(np.min(rho_s), np.max(rho_s), 25)\n\n# # Create the histogram\n# plt.figure()\n# plt.hist(rho_s, bins=bin_edges, edgecolor=None)\n# plt.xlabel('Snow density [kg m-3]')\n# plt.ylabel('Counts')\n# plt.show()","key":"RttuEayy2r"},{"type":"outputs","id":"Rska6AmBf7B1xWTuIXelr","children":[],"key":"auC6g4FjyG"}],"key":"ug70yKB5f3"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"There‚Äôs some pretty unrealistic values in the data, so let‚Äôs zoom in to more realistic densities.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XYb6PFEWzT"}],"key":"CNIzfsQlJH"}],"key":"ucJgKskpAW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# # Re-define bin edges\n# bin_edges = np.arange(0, 500, 25)\n\n# # Create refined histogram\n# plt.figure()\n# plt.hist(rho_s, bins=bin_edges, edgecolor='black')\n# plt.xlabel('Snow density [kg m-3]')\n# plt.ylabel('Counts')\n# plt.show()","key":"RtrshI8L5l"},{"type":"outputs","id":"bxfV5cIAryCZGP-rZdgfi","children":[],"key":"UctsxnJqYb"}],"key":"jBykyngVCH"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Even at this range, there is a fair amount of random error. This may be caused by the measurement accuracy of the lidar or the GPR, the depth of the snow, and/or geolocation uncertainty.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K7hCTc19J4"}],"key":"ZFssxEMK7H"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"A user could further improve these densities by upsampling the lidar to match the GPR‚Äôs geolocation uncertainty (3 m in this case), remove erroneous values in the snow depth or permittivity data, or run a spatial averaging filter.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dTH8JUn7HZ"}],"key":"sKpM3kx9yR"}],"key":"CpEqyxTi9y"}],"key":"ZsdXyYLAFW"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"SnowExSQL Database","url":"/notebooks/snowexsql-database","group":"Data Access"},"next":{"title":"Thermal Infrared","url":"/notebooks/thermal-ir-tutorial","group":"Observations"}}},"domain":"http://localhost:3000"}